# å‰è¨€

æˆ‘ç—›æ¨ä¸–ç•Œä¸Šæ‰€æœ‰çš„èšŠå­ï¼Œå¦‚æœè¯´æ¯ä¸€æ¬¡ç†¬å¤œéƒ½æ˜¯åœ¨å…´å¥‹ä¸­æŒ£æ‰ï¼Œé‚£ä¹ˆæ¯ä¸€æ¬¡æ—©èµ·éƒ½æºäºçƒ­é—¹çš„çº·æ‰°ã€‚æˆ‘è¯•å›¾æ‰¾åˆ°è¿™åªå¼€æ½œè¡Œçš„èšŠå­ï¼Œä½†æ˜¯å¤±è´¥äº†ï¼Œç”Ÿæ°”ï¼

è¿˜æ˜¯çœ‹çœ‹ä»Šå¤©è¯¥å¹²ä»€ä¹ˆå§ï¼š
1. ç»§ç»­å­¦MySQLåŸºç¡€ç¯‡å‰©ä¸‹çš„å†…å®¹
2. çœ‹çœ‹æ˜¨å¤©å‘çš„blogæœ‰æ²¡æœ‰è¦ä¿®æ”¹çš„åœ°æ–¹
3. ç»§ç»­è°ƒæ•™AI

emmmmï¼Œå¼€å·ï¼

---

# æ—¥ç¨‹

ä¸€å¤§æ—©å°±é†’äº†ï¼Œå­¦åˆ°10ç‚¹åœä¸‹æ¥åšä¸€ä¸‹blogï¼Œæœ‰æ•ˆæ—¶é—´å¤§æ¦‚2å°æ—¶å§ã€‚
> psï¼šå†™blogåˆèŠ±äº†ä¸€ä¸ªå°æ—¶ï¼Œä¸æ˜¯å“¥ä»¬ï¼ŒåŸæ¥å†™blogè¿™ä¹ˆç´¯çš„å—ï¼Ÿ

æˆ‘è¦å‘deepseekå¤§å“¥é“æ­‰ğŸ˜­ï¼Œå…¶å®å¤§å“¥ç”Ÿæˆçš„markdownæ–‡æ¡£æ˜¯å®Œæ•´çš„ï¼Œåªä¸è¿‡å› ä¸ºæµè§ˆå™¨çš„é˜…è¯»æ•ˆæœçœ‹èµ·æ¥åƒåˆ†å—äº†ï¼Œå¤§å“¥ğŸ˜­åˆšåˆšæ˜¯å¤–é¢äººå¤šï¼Œç°åœ¨æˆ‘ç»™ä½ è·ªä¸‹äº†ã€‚

ä¸­åˆï¼ŒæŠŠå‡½æ•°éƒ¨åˆ†å­¦äº†

æ™šä¸Šï¼Œå¼€ä¼šï¼Œå­¦çº¦æŸï¼Œå¤šè¡¨æŸ¥è¯¢ã€‚å‰©ä¸‹äº‹åŠ¡å­¦ä¸å®Œï¼Œç•™åˆ°æ˜å¤©äº†ã€‚

æ‰€ä»¥æ˜å¤©å°±ä¸€å¹¶æŠŠä»Šæ˜¨ä¸¤å¤©çš„blogå¤ä¹ ä¸€ä¸‹ã€‚

---

# å­¦ä¹ å†…å®¹

## çœæµ

1. DataGrip
2. DML
3. DQL
4. DCL
5. å‡½æ•°
6. çº¦æŸ
7. å¤šè¡¨æŸ¥è¯¢ï¼ˆé‡ç‚¹ï¼‰

## 1. DataGrip

SQLçš„å›¾å½¢åŒ–å·¥å…·ï¼Œå…¶å®æ²¡ä»€ä¹ˆå¥½è®²å§ï¼Œä¹Ÿå°±å®‰ä¸€ä¸‹è½¯ä»¶ã€‚é¡¹ç›®ç»„è¦æ±‚ä½¿ç”¨çš„å›¾å½¢åŒ–å·¥å…·æ˜¯navicatï¼Œè¿™ä¸ªåé¢å†è§£å†³ã€‚

## 2. DML

å¯¹è¡¨çš„æ•°æ®è¿›è¡Œæ“ä½œã€‚

- **æ’å…¥**ï¼š
    ```sql
    insert into è¡¨å (å­—æ®µå1,2,3/*ä¸å†™åˆ™ä¸ºå…¨éƒ¨å­—æ®µ*/) values(å€¼1,2,3/*ä¸å­—æ®µåä¸€ä¸€å¯¹åº”*/),(å€¼1,2,3),...,(å€¼1,2,3);
    ```
    ä¾‹ï¼š
    ```sql
    insert into emp(id, workno, name, gender, age, idcard, entrydate)
        values(1,'1','Itcast','ç”·',10,'123451232312','2000-01-01');
    ```

- **ä¿®æ”¹**ï¼š
    ```sql
    update è¡¨å set å­—æ®µå1 = å€¼1,å­—æ®µå2 = å€¼2,...ã€where æ¡ä»¶ã€‘;
    ```
    ä¾‹ï¼š
    ```sql
    update emp set age = 18,name = 'heyi' where id = 1;
    ```

- **åˆ é™¤**ï¼š
    ```sql
    delete from è¡¨å ã€where æ¡ä»¶ã€‘;
    ```
    !ä¸å†™æ¡ä»¶ä¼šæŠŠæ‰€æœ‰æ•°æ®åˆ æ‰
    ä¾‹ï¼š
    ```sql
    delete from emp where name = 'heyi';
    ```

## 3. DQL

æŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ã€‚

- **åŸºæœ¬æŸ¥è¯¢**ï¼š
    ```sql
    select ã€distinct /*å»é‡*/ã€‘ å­—æ®µ1ã€as åˆ«åã€‘,2ã€as åˆ«åã€‘ from è¡¨å;
    ```
    !ä»…å½“æ‰€æœ‰å­—æ®µéƒ½ç›¸åŒæ—¶æ‰ä¼šå»é‡ã€‚
    ä¾‹ï¼š
    ```sql
    select distinct name, id as 'ç¼–å·',age from emp;
    ```

- **æ¡ä»¶æŸ¥è¯¢**ï¼š
    ```sql
    select å­—æ®µåˆ—è¡¨ from è¡¨å where æ¡ä»¶åˆ—è¡¨;
    ```
    æ¡ä»¶åˆ—è¡¨ï¼š
    | æ¯”è¾ƒè¿ç®—ç¬¦   | åŠŸèƒ½                             |
    |--------------|----------------------------------|
    | >            | å¤§äº                             |
    | >=           | å¤§äºç­‰äº                         |
    | <            | å°äº                             |
    | <=           | å°äºç­‰äº                         |
    | =            | ç­‰äº                             |
    | <> æˆ– !=     | ä¸ç­‰äº                           |
    | BETWEEN ... AND ... | åœ¨æŸä¸ªèŒƒå›´ä¹‹å†…(å«æœ€å°ã€æœ€å¤§å€¼) |
    | IN(...)      | åœ¨inä¹‹åçš„åˆ—è¡¨ä¸­çš„å€¼ï¼Œå¤šé€‰ä¸€     |
    | LIKE _ æˆ– %(é‡è¦)   | æ¨¡ç³ŠåŒ¹é…(_åŒ¹é…å•ä¸ªå­—ç¬¦ï¼Œ%åŒ¹é…ä»»æ„ä¸ªå­—ç¬¦) |
    | IS NULL      | æ˜¯NULL                           |

    | é€»è¾‘è¿ç®—ç¬¦   | åŠŸèƒ½                             |
    |--------------|----------------------------------|
    | AND æˆ– &&    | å¹¶ä¸”(å¤šä¸ªæ¡ä»¶åŒæ—¶æˆç«‹)           |
    | OR æˆ– ||     | æˆ–è€…(å¤šä¸ªæ¡ä»¶ä»»æ„ä¸€ä¸ªæˆç«‹)       |
    | NOT æˆ– !     | éï¼Œä¸æ˜¯                         |

    ä¾‹ï¼š
    ```sql
    --æ‹¬å·å¯æœ‰å¯æ— 
    --è¿™é‡Œæ¨¡ç³ŠåŒ¹é…äº†å°¾å·ä¸º2çš„idcard
    select * from emp where (idcard like '%2');
    ```

- **èšåˆå‡½æ•°**ï¼šå°†ä¸€åˆ—æ•°æ®è¿›è¡Œè®¡ç®—ç»Ÿè®¡ï¼Œåˆä¸ºä¸€ä¸ªæ•´ä½“ã€‚
    ```sql
    select èšåˆå‡½æ•°(å­—æ®µåˆ—è¡¨) from è¡¨å;
    ```
    å¸¸ç”¨èšåˆå‡½æ•°ï¼š
    | å‡½æ•°  | åŠŸèƒ½     |
    |-------|----------|
    | count | ç»Ÿè®¡æ•°é‡ |
    | max   | æœ€å¤§å€¼   |
    | min   | æœ€å°å€¼   |
    | avg   | å¹³å‡å€¼   |
    | sum   | æ±‚å’Œ     |

    ä¾‹ï¼š
    ```sql
    select count(*) from emp;
    ```

- **åˆ†ç»„æŸ¥è¯¢**ï¼š
    ```sql
    select å­—æ®µåˆ—è¡¨ from è¡¨å ã€where æ¡ä»¶ã€‘ group by åˆ†ç»„å­—æ®µå ã€having åˆ†ç»„åè¿‡æ»¤æ¡ä»¶ã€‘;
    ```
    !whereè¿‡æ»¤åˆ†ç»„å‰æ•°æ®ï¼Œhavingè¿‡æ»¤åˆ†ç»„åæ•°æ®;
    ä¾‹ï¼š
    ```sql
    --ç­›é€‰idcardå°¾å·ä¸º2çš„->æŒ‰genderåˆ†ç»„->ç­›é€‰æ•°é‡å°äºç­‰äº2çš„
    select gender,count(*) from emp where idcard like '%2' group by gender having count(*) <=2;
    ```

- **æ’åºæŸ¥è¯¢**:
    ```sql
    select å­—æ®µåˆ—è¡¨ from è¡¨å order by å­—æ®µ1 æ’åºæ–¹å¼1,
    å­—æ®µ2 æ’åºæ–¹å¼2;
    ```
    æ’åºæ–¹å¼ï¼šascï¼ˆå‡åºï¼‰ descï¼ˆé™åºï¼‰
    !å­—æ®µ1æ’åºä¼˜å…ˆçº§ > å­—æ®µ2 ï¼ˆ1ç›¸åŒæ—¶,æ’2ï¼‰
    ä¾‹ï¼š
    ```sql
    select * from emp order by age asc ,idcard desc,gender desc;
    ```

- **åˆ†é¡µæŸ¥è¯¢**:
    ```sql
    select å­—æ®µåˆ—è¡¨ from è¡¨å limit èµ·å§‹ç´¢å¼•,å±•ç¤ºè®°å½•æ•°;
    ```
    !èµ·å§‹ç´¢å¼• = (æŸ¥è¯¢é¡µç -1)*æ¯é¡µå±•ç¤ºè®°å½•æ•°
    ä¾‹ï¼š
    ```sql
    select * from emp limit 0,10;
    ```

- **æ‰§è¡Œé¡ºåº(é‡è¦)**:
    ```mermaid
    graph LR
        A[FROM è¡¨ååˆ—è¡¨] --> B[WHERE æ¡ä»¶åˆ—è¡¨]
        B --> C[GROUP BY åˆ†ç»„å­—æ®µåˆ—è¡¨]
        C --> D[HAVING åˆ†ç»„åæ¡ä»¶åˆ—è¡¨]
        D --> E[SELECT å­—æ®µåˆ—è¡¨]
        E --> F[ORDER BY æ’åºå­—æ®µåˆ—è¡¨]
        F --> G[LIMIT åˆ†é¡µå‚æ•°]
    ```

## 4. DCL(ç•¥è¿‡)

æ§åˆ¶æ•°æ®åº“çš„è®¿é—®æƒé™ã€‚

### SQL ç”¨æˆ·ç®¡ç†å‘½ä»¤

1. **æŸ¥è¯¢ç”¨æˆ·**
    ```sql
    USE mysql;
    SELECT * FROM user;
    ```

2. **åˆ›å»ºç”¨æˆ·**
    ```sql
    CREATE USER 'ç”¨æˆ·å'@'ä¸»æœºå' IDENTIFIED BY 'å¯†ç ';
    ```

3. **ä¿®æ”¹ç”¨æˆ·å¯†ç **
    ```sql
    ALTER USER 'ç”¨æˆ·å'@'ä¸»æœºå' IDENTIFIED WITH mysql_native_password BY 'æ–°å¯†ç ';
    ```

4. **åˆ é™¤ç”¨æˆ·**
    ```sql
    DROP USER 'ç”¨æˆ·å'@'ä¸»æœºå';
    ```

### å¸¸ç”¨æƒé™

| æƒé™            | è¯´æ˜               |
|-----------------|--------------------|
| ALL, ALL PRIVILEGES | æ‰€æœ‰æƒé™           |
| SELECT          | æŸ¥è¯¢æ•°æ®           |
| INSERT          | æ’å…¥æ•°æ®           |
| UPDATE          | ä¿®æ”¹æ•°æ®           |
| DELETE          | åˆ é™¤æ•°æ®           |
| ALTER           | ä¿®æ”¹è¡¨             |
| DROP            | åˆ é™¤æ•°æ®åº“/è¡¨/è§†å›¾ |
| CREATE          | åˆ›å»ºæ•°æ®åº“/è¡¨      |

### DCL-æƒé™æ§åˆ¶

1. **æŸ¥è¯¢æƒé™**
    ```sql
    SHOW GRANTS FOR 'ç”¨æˆ·å'@'ä¸»æœºå';
    ```

2. **æˆäºˆæƒé™**
    ```sql
    GRANT æƒé™åˆ—è¡¨ ON æ•°æ®åº“å.è¡¨å TO 'ç”¨æˆ·å'@'ä¸»æœºå';
    ```

3. **æ’¤é”€æƒé™**
    ```sql
    REVOKE æƒé™åˆ—è¡¨ ON æ•°æ®åº“å.è¡¨å FROM 'ç”¨æˆ·å'@'ä¸»æœºå';
    ```

## 5. å‡½æ•°

Mysqlå†…ç½®çš„ä¸€äº›æ–¹æ³•

| å­—ç¬¦ä¸²å‡½æ•°                 | åŠŸèƒ½                                                                 |
|---------------------------|----------------------------------------------------------------------|
| CONCAT(S1,S2,...Sn)       | å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå°†S1ï¼ŒS2ï¼Œ... Snæ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²                         |
| LOWER(str)                | å°†å­—ç¬¦ä¸²strå…¨éƒ¨è½¬ä¸ºå°å†™                                             |
| UPPER(str)                | å°†å­—ç¬¦ä¸²strå…¨éƒ¨è½¬ä¸ºå¤§å†™                                             |
| LPAD(str,n,pad)           | å·¦å¡«å……ï¼Œç”¨å­—ç¬¦ä¸²padå¯¹strçš„å·¦è¾¹è¿›è¡Œå¡«å……ï¼Œè¾¾åˆ°nä¸ªå­—ç¬¦ä¸²é•¿åº¦            |
| RPAD(str,n,pad)           | å³å¡«å……ï¼Œç”¨å­—ç¬¦ä¸²padå¯¹strçš„å³è¾¹è¿›è¡Œå¡«å……ï¼Œè¾¾åˆ°nä¸ªå­—ç¬¦ä¸²é•¿åº¦            |
| TRIM(str)                 | å»æ‰å­—ç¬¦ä¸²å¤´éƒ¨å’Œå°¾éƒ¨çš„ç©ºæ ¼                                           |
| SUBSTRING(str,start,len)  | è¿”å›ä»å­—ç¬¦ä¸²strä»startä½ç½®èµ·çš„lenä¸ªé•¿åº¦çš„å­—ç¬¦ä¸²                      |

| æ•°å€¼å‡½æ•°          | åŠŸèƒ½                                      |
|---------------|-------------------------------------------|
| CEIL(x)       | å‘ä¸Šå–æ•´                                  |
| FLOOR(x)      | å‘ä¸‹å–æ•´                                  |
| MOD(x,y)      | è¿”å›x/yçš„æ¨¡                               |
| RAND()        | è¿”å›0~1å†…çš„éšæœºæ•°                         |
| ROUND(x,y)    | æ±‚å‚æ•°xçš„å››èˆäº”å…¥çš„å€¼ï¼Œä¿ç•™yä½å°æ•°        |

```sql
-- æ¡ˆä¾‹: é€šè¿‡æ•°æ®åº“çš„å‡½æ•°ï¼Œç”Ÿæˆä¸€ä¸ªå…­ä½æ•°çš„éšæœºéªŒè¯ç ã€‚
SELECT LPAD(ROUND(RAND() * 1000000, 0), 6, '0');
```

| æ—¥æœŸå‡½æ•°                          | åŠŸèƒ½                                                                 |
|-------------------------------|----------------------------------------------------------------------|
| CURDATE()                     | è¿”å›å½“å‰æ—¥æœŸ                                                         |
| CURTIME()                     | è¿”å›å½“å‰æ—¶é—´                                                         |
| NOW()                         | è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´                                                   |
| YEAR(date)                    | è·å–æŒ‡å®šdateçš„å¹´ä»½                                                   |
| MONTH(date)                   | è·å–æŒ‡å®šdateçš„æœˆä»½                                                   |
| DAY(date)                     | è·å–æŒ‡å®šdateçš„æ—¥æœŸ                                                   |
| DATE_ADD(date, INTERVAL expr_type) | è¿”å›ä¸€ä¸ªæ—¥æœŸ/æ—¶é—´å€¼åŠ ä¸Šä¸€ä¸ªæ—¶é—´é—´éš”expråçš„æ—¶é—´å€¼               |
| DATEDIFF(date1, date2)        | è¿”å›èµ·å§‹æ—¶é—´date1å’Œç»“æŸæ—¶é—´date2ä¹‹é—´çš„å¤©æ•°                           |

è¡¥å……è¯´æ˜ï¼š
`DATE_ADD(date, INTERVAL expr_type)` ä¸­çš„ `expr_type` å¯ä»¥æ˜¯ `DAY`, `MONTH`, `YEAR` ç­‰æ—¶é—´å•ä½

| æµç¨‹å‡½æ•° | åŠŸèƒ½ |
|------|------|
| `IF(value, t, f)` | å¦‚æœvalueä¸ºtrueï¼Œåˆ™è¿”å›tï¼Œå¦åˆ™è¿”å›f |
| `IFNULL(value1, value2)` | å¦‚æœvalue1ä¸ä¸ºç©ºï¼Œè¿”å›value1ï¼Œå¦åˆ™è¿”å›value2 |
| `CASE WHEN [val1] THEN [res1] ... ELSE [default] END` | å¦‚æœval1ä¸ºtrueï¼Œè¿”å›res1ï¼Œ...å¦åˆ™è¿”å›defaulté»˜è®¤å€¼ |
| `CASE [expr] WHEN [val1] THEN [res1] ... ELSE [default] END` | å¦‚æœexprçš„å€¼ç­‰äºval1ï¼Œè¿”å›res1ï¼Œ...å¦åˆ™è¿”å›defaulté»˜è®¤å€¼ |

ä¾‹:
```sql
select 
    name,
    (case address when 'åŒ—äº¬' then 'ä¸€çº¿' when 'ä¸Šæµ·' then 'ä¸€çº¿' else 'äºŒçº¿' end)
from emp;
```

## 6. çº¦æŸ

ä½œç”¨äºè¡¨ä¸­å­—æ®µï¼Œå¯¹å­—æ®µæ•°æ®åšå‡ºè§„åˆ™ã€‚

| çº¦æŸç±»å‹ | æè¿° | å…³é”®å­— |
|----------|------|--------|
| éç©ºçº¦æŸ | é™åˆ¶è¯¥å­—æ®µçš„æ•°æ®ä¸èƒ½ä¸ºnull | NOT NULL |
| å”¯ä¸€çº¦æŸ | ä¿è¯è¯¥å­—æ®µçš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯å”¯ä¸€ã€ä¸é‡å¤çš„ | UNIQUE |
| ä¸»é”®çº¦æŸ | ä¸»é”®æ˜¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ ‡è¯†ï¼Œè¦æ±‚éç©ºä¸”å”¯ä¸€ | PRIMARY KEY |
| é»˜è®¤çº¦æŸ | ä¿å­˜æ•°æ®æ—¶ï¼Œå¦‚æœæœªæŒ‡å®šè¯¥å­—æ®µçš„å€¼ï¼Œåˆ™é‡‡ç”¨é»˜è®¤å€¼ | DEFAULT |
| æ£€æŸ¥çº¦æŸ | ä¿è¯å­—æ®µå€¼æ»¡è¶³æŸä¸€ä¸ªæ¡ä»¶ï¼ˆMySQL 8.0.16+ç‰ˆæœ¬æ”¯æŒï¼‰ | CHECK |
| å¤–é”®çº¦æŸ | ç”¨æ¥è®©ä¸¤å¼ è¡¨çš„æ•°æ®ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ | FOREIGN KEY |

ä¾‹ï¼š
| å­—æ®µå | å­—æ®µå«ä¹‰ | å­—æ®µç±»å‹ | çº¦æŸæ¡ä»¶ |
|--------|----------|----------|----------------------------------|
| id     | IDå”¯ä¸€æ ‡è¯† | int      | ä¸»é”®ï¼Œå¹¶ä¸”è‡ªåŠ¨å¢é•¿              |
| name   | å§“å     | varchar(10) | ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å”¯ä¸€               |
| age    | å¹´é¾„     | int      | å¤§äº0ï¼Œå¹¶ä¸”å°äºç­‰äº120          |
| status | çŠ¶æ€     | char(1)  | å¦‚æœæ²¡æœ‰æŒ‡å®šè¯¥å€¼ï¼Œé»˜è®¤ä¸º1       |
| gender | æ€§åˆ«     | char(1)  | æ—                               |

å¯¹åº”çš„SQLå»ºè¡¨è¯­å¥ï¼š
```sql
CREATE TABLE user_info (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(10) NOT NULL UNIQUE,
    age INT CHECK (age > 0 AND age <= 120),
    status CHAR(1) DEFAULT '1',
    gender CHAR(1)
);
```

### å¤–é”®çº¦æŸ

æ·»åŠ å¤–é”®ï¼ˆæ·»åŠ å¤–é”®çš„è¡¨ä½œä¸ºå­è¡¨ï¼‰
```sql
alter table è¡¨å add constraint å¤–é”®åç§° foreign key(å¤–é”®å­—æ®µå) references ä¸»è¡¨(ä¸»è¡¨åˆ—å);
```
```sql
alter table emp add constraint fk_emp_dept_id foreign key(dept_id) references dept(id);
```
åˆ é™¤å¤–é”®
```sql
alter table è¡¨å drop foreign key å¤–é”®åç§°;
```

æ›´æ–°/åˆ é™¤è¡Œä¸º
| è¡Œä¸º         | è¯´æ˜                                                                                     |
|--------------|------------------------------------------------------------------------------------------|
| NO ACTION    | å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°è®°å½•æ—¶ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œæœ‰åˆ™é˜»æ­¢æ“ä½œï¼ˆä¸ RESTRICT ç›¸åŒï¼‰          |
| RESTRICT     | å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°è®°å½•æ—¶ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”å¤–é”®ï¼Œæœ‰åˆ™é˜»æ­¢æ“ä½œï¼ˆä¸ NO ACTION ç›¸åŒï¼‰        |
| CASCADE      | å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤/æ›´æ–°è®°å½•æ—¶ï¼ŒåŒæ­¥åˆ é™¤/æ›´æ–°å­è¡¨ä¸­å…³è”çš„è®°å½•                                 |
| SET NULL     | å½“åœ¨çˆ¶è¡¨ä¸­åˆ é™¤è®°å½•æ—¶ï¼Œå°†å­è¡¨ä¸­å¯¹åº”å¤–é”®å€¼è®¾ä¸º NULLï¼ˆéœ€å¤–é”®å…è®¸ä¸º NULLï¼‰                   |
| SET DEFAULT  | çˆ¶è¡¨å˜æ›´æ—¶ï¼Œå­è¡¨å¤–é”®åˆ—è®¾ä¸ºé»˜è®¤å€¼ï¼ˆInnoDB å¼•æ“ä¸æ”¯æŒï¼‰                                    |

```sql
alter table è¡¨å add constraint å¤–é”®åç§° foreign key(å¤–é”®å­—æ®µå) references ä¸»è¡¨(ä¸»è¡¨åˆ—å) on update è¡Œä¸º on delete è¡Œä¸º;
```

!ä¸èƒ½ç›´æ¥ä¿®æ”¹ç°æœ‰çš„å¤–é”®çº¦æŸçš„æ›´æ–°å’Œåˆ é™¤è¡Œä¸ºã€‚

æ³¨ï¼šå¤§éƒ¨åˆ†æ“ä½œéƒ½å¯ä»¥åœ¨å›¾å½¢åŒ–ç•Œé¢ä¸­çš„modify tableå®Œæˆ

## 7. å¤šè¡¨æŸ¥è¯¢

### å‡†å¤‡æ•°æ®

```sql
create table dept(
    id   int auto_increment comment 'ID' primary key,
    name varchar(50) not null comment 'éƒ¨é—¨åç§°'
)comment 'éƒ¨é—¨è¡¨';

create table emp(
    id  int auto_increment comment 'ID' primary key,
    name varchar(50) not null comment 'å§“å',
    age  int comment 'å¹´é¾„',
    job varchar(20) comment 'èŒä½',
    salary int comment 'è–ªèµ„',
    entrydate date comment 'å…¥èŒæ—¶é—´',
    managerid int comment 'ç›´å±é¢†å¯¼ID',
    dept_id int comment 'éƒ¨é—¨ID'
)comment 'å‘˜å·¥è¡¨';

alter table emp add constraint fk_emp_dept_id foreign key (dept_id) references dept(id);

INSERT INTO dept (id, name) VALUES (1, 'ç ”å‘éƒ¨'), (2, 'å¸‚åœºéƒ¨'),(3, 'è´¢åŠ¡éƒ¨'), (4, 'é”€å”®éƒ¨'), (5, 'æ€»ç»åŠ'), (6, 'äººäº‹éƒ¨');
INSERT INTO emp (id, name, age, job,salary, entrydate, managerid, dept_id) VALUES
            (1, 'é‡‘åº¸', 66, 'æ€»è£',20000, '2000-01-01', null,5),

            (2, 'å¼ æ— å¿Œ', 20, 'é¡¹ç›®ç»ç†',12500, '2005-12-05', 1,1),
            (3, 'æ¨é€', 33, 'å¼€å‘', 8400,'2000-11-03', 2,1),
            (4, 'éŸ¦ä¸€ç¬‘', 48, 'å¼€å‘',11000, '2002-02-05', 2,1),
            (5, 'å¸¸é‡æ˜¥', 43, 'å¼€å‘',10500, '2004-09-07', 3,1),
            (6, 'å°æ˜­', 19, 'ç¨‹åºå‘˜é¼“åŠ±å¸ˆ',6600, '2004-10-12', 2,1),

            (7, 'ç­ç»', 60, 'è´¢åŠ¡æ€»ç›‘',8500, '2002-09-12', 1,3),
            (8, 'å‘¨èŠ·è‹¥', 19, 'ä¼šè®¡',48000, '2006-06-02', 7,3),
            (9, 'ä¸æ•å›', 23, 'å‡ºçº³',5250, '2009-05-13', 7,3),

            (10, 'èµµæ•', 20, 'å¸‚åœºéƒ¨æ€»ç›‘',12500, '2004-10-12', 1,2),
            (11, 'é¹¿æ–å®¢', 56, 'èŒå‘˜',3750, '2006-10-03', 10,2),
            (12, 'é¹¤ç¬”ç¿', 19, 'èŒå‘˜',3750, '2007-05-09', 10,2),
            (13, 'æ–¹ä¸œç™½', 19, 'èŒå‘˜',5500, '2009-02-12', 10,2),

            (14, 'å¼ ä¸‰ä¸°', 88, 'é”€å”®æ€»ç›‘',14000, '2004-10-12', 1,4),
            (15, 'ä¿è²èˆŸ', 38, 'é”€å”®',4600, '2004-10-12', 14,4),
            (16, 'å®‹è¿œæ¡¥', 40, 'é”€å”®',4600, '2004-10-12', 14,4),
            (17, 'é™ˆå‹è°…', 42, null,2000, '2011-10-12', 1,null);
```

### å¤šè¡¨å…³ç³»

- ä¸€å¯¹ä¸€
    ```mermaid
    graph TD
        A[å­¦ç”Ÿè¡¨] -- "ä¸€å¯¹ä¸€" --> B[å­¦ç”Ÿè¯è¡¨]
        A -- "å­¦å·" --> B
        B -- "å­¦ç”Ÿè¯å·" --> A
    ```

- å¤šå¯¹ä¸€
    ```mermaid
    graph TD
        A[å­¦ç”Ÿè¡¨] -- "å¤šå¯¹ä¸€" --> B[ç­çº§è¡¨]
        A -- "ç­çº§ç¼–å·" --> B
        B -- "ç­çº§åç§°" --> A
    ```

- å¤šå¯¹å¤š
    ```mermaid
    graph TD
        A[å­¦ç”Ÿè¡¨] -- "å¤šå¯¹å¤š" --> C[é€‰è¯¾è¡¨] -- "å¤šå¯¹å¤š" --> B[è¯¾ç¨‹è¡¨]
        A -- "å­¦ç”ŸID" --> C
        C -- "è¯¾ç¨‹ID" --> B
        B -- "è¯¾ç¨‹åç§°" --> C
        C -- "é€‰è¯¾è®°å½•" --> A
    ```

### è¿æ¥æ–¹å¼

- å†…è¿æ¥
    ```mermaid
    graph TD;
        subgraph "é›†åˆ A"
            A1(å…ƒç´ 1)
            A2(å…ƒç´ 2)
        end
        subgraph "é›†åˆ B"
            B1(å…ƒç´ 1)
            B2(å…ƒç´ 3)
        end
        subgraph "äº¤é›†"
            AB(å…ƒç´ 1)
        end
        A1 --> AB
        B1 --> AB
    ```
    éšè¿æ¥
    ```sql
    select emp.name,dept.name from emp,dept where emp.dept_id = dept.id;
    ```
    æ˜¾è¿æ¥
    ```sql
    select e.name,d.name from emp e join dept d on e.dept_id = d.id;
    ```

- å·¦è¿æ¥
    ```mermaid
    graph TD;
        subgraph "é›†åˆ A"
            A1(å…ƒç´ 1)
            A2(å…ƒç´ 2)
        end
        subgraph "é›†åˆ B"
            B1(å…ƒç´ 1)
            B2(å…ƒç´ 3)
        end
        subgraph "äº¤é›†"
            AB(å…ƒç´ 1)
        end
        A1 --> AB
        B1 --> AB
        A2 -->|ä¸åŒ¹é…| B2
    ```
    ```sql
    select e.name,d.name from emp e left join dept d on e.dept_id = d.id;
    ```

- å³è¿æ¥
    ```mermaid
    graph TD;
        subgraph "é›†åˆ A"
            A1(å…ƒç´ 1)
            A2(å…ƒç´ 2)
        end
        subgraph "é›†åˆ B"
            B1(å…ƒç´ 1)
            B2(å…ƒç´ 3)
        end
        subgraph "äº¤é›†"
            AB(å…ƒç´ 1)
        end
        A1 --> AB
        B1 --> AB
        A2 -->|ä¸åŒ¹é…| B2
        B2 -->|ä¸åŒ¹é…| A1
    ```
    ```sql
    select e.name,d.name from emp e right join dept d on e.dept_id = d.id;
    ```

- è‡ªè¿æ¥
    ä¾‹ï¼šæŸ¥è¯¢å‘˜å·¥åŠå…¶é¢†å¯¼çš„åå­—
    ```sql
    select a.name as 'å‘˜å·¥',b.name as 'é¢†å¯¼' from emp a left outer join emp b on a.managerid = b.id;
    ```

### è”åˆæŸ¥è¯¢

å°†å¤šæ¬¡æŸ¥è¯¢çš„ç»“æœåˆå¹¶èµ·æ¥ï¼Œå½¢æˆæ–°çš„æŸ¥è¯¢ç»“æœé›†ã€‚
```sql
select å­—æ®µåˆ—è¡¨ from è¡¨A
union ã€allã€‘
select å­—æ®µåˆ—è¡¨ from è¡¨B
```
!allæ—¶ä¸ä¼šå¯¹æ•°æ®è¿›è¡Œå»é‡
ï¼è¡¨çš„åˆ—æ•°ï¼Œå­—æ®µç±»å‹éœ€è¦ä¸€è‡´

### å­æŸ¥è¯¢ï¼ˆé‡ç‚¹ï¼‰ï¼š

åœ¨SQLè¯­å¥ä¸­åµŒå¥—selectè¯­å¥

- æ ‡é‡å­æŸ¥è¯¢
    ```sql
    --æŸ¥è¯¢é”€å”®éƒ¨å‘˜å·¥ä¿¡æ¯
    select id from dept where name = 'é”€å”®éƒ¨'; --å­æŸ¥è¯¢ç»“æœä¸ºå•ç‚¹
    select * from emp where dept_id = (select id from dept where name = 'é”€å”®éƒ¨');
    ```

- åˆ—å­æŸ¥è¯¢
    ```sql
    -- æŸ¥è¯¢æ¯” è´¢åŠ¡éƒ¨ æ‰€æœ‰äººå·¥èµ„éƒ½é«˜çš„å‘˜å·¥ä¿¡æ¯
    select salary from emp where dept_id = (select id from dept where name = 'è´¢åŠ¡éƒ¨'); --å­æŸ¥è¯¢ç»“æœä¸ºä¸€åˆ—
    select * from emp where salary > all(select salary from emp where dept_id = (select id from dept where name = 'è´¢åŠ¡éƒ¨'));
    ```

- è¡Œå­æŸ¥è¯¢
    ```sql
    --æŸ¥è¯¢ä¸å¼ æ— å¿Œ å·¥èµ„å’Œé¢†å¯¼ç›¸åŒçš„å‘˜å·¥ä¿¡æ¯
    select salary,managerid from emp where name = 'å¼ æ— å¿Œ'; --å­æŸ¥è¯¢ç»“æœä¸ºä¸€è¡Œ
    select * from emp where (salary,managerid) = (select salary,managerid from emp where name = 'å¼ æ— å¿Œ');
    ```

- è¡¨å­æŸ¥è¯¢
    ```sql
    -- æŸ¥è¯¢å…¥èŒæ—¥æœŸæ˜¯ "2006-01-01" ä¹‹åçš„å‘˜å·¥ä¿¡æ¯ , åŠå…¶éƒ¨é—¨ä¿¡æ¯
    select * from emp where entrydate > '2006-01-01'; --å­æŸ¥è¯¢ç»“æœä¸ºè¡¨
    select e.*,dept.* from (select * from emp where entrydate > '2006-01-01') e left outer join dept on e.dept_id = dept.id;
    ```

### é‡ç‚¹æ¡ˆä¾‹

- 10. æŸ¥è¯¢ä½äºæœ¬éƒ¨é—¨å¹³å‡å·¥èµ„çš„å‘˜å·¥ä¿¡æ¯

    ```sql
    -- a. æŸ¥è¯¢æŒ‡å®šéƒ¨é—¨å¹³å‡è–ªèµ„ 
    select avg(e1.salary) from emp e1 where e1.dept_id = 1;
    select avg(e1.salary) from emp e1 where e1.dept_id = 2;

    -- b. æŸ¥è¯¢ä½äºæœ¬éƒ¨é—¨å¹³å‡å·¥èµ„çš„å‘˜å·¥ä¿¡æ¯
    select * from emp e2 where e2.salary < ( select avg(e1.salary) from emp e1 where e1.dept_id = e2.dept_id );
    ```

- 11. æŸ¥è¯¢æ‰€æœ‰çš„éƒ¨é—¨ä¿¡æ¯, å¹¶ç»Ÿè®¡éƒ¨é—¨çš„å‘˜å·¥äººæ•°
    ```sql
    select d.id, d.name , ( select count(*) from emp e where e.dept_id = d.id ) 'äººæ•°' from dept d;
    ```

- 12. æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿçš„é€‰è¯¾æƒ…å†µ, å±•ç¤ºå‡ºå­¦ç”Ÿåç§°, å­¦å·, è¯¾ç¨‹åç§°
    -- è¡¨: student , course , student_course
    -- è¿æ¥æ¡ä»¶: student.id = student_course.studentid , course.id = student_course.courseid
    ```sql
    select s.name , s.no , c.name from student s , student_course sc , course c where s.id = sc.studentid and sc.courseid = c.id;
    ```

---

# ç»“è¯­

æˆ‘åº”å½“é‡æ–°è€ƒè™‘ä¸€ä¸‹blogçš„ä¹¦å†™æ–¹å¼äº†ï¼Œå¦‚æœåœ¨è¿™ä¸ªåœ°æ–¹èŠ±è´¹å¤ªé•¿çš„æ—¶é—´ï¼Œå¿…ç„¶ä¼šå½±å“æ­£å¸¸çš„å­¦ä¹ ã€‚å†™blogæ˜¯å¦æœ‰åŠ©äºæˆ‘çš„å­¦ä¹ ï¼Œè¿˜æœ‰å¾…è€ƒç©¶ã€‚ä¸”è¿‡ä¸”è¡Œå§ã€‚