# ä¸€å¤©çš„å­¦ä¹ æ€»ç»“ï¼šå‘˜å·¥ç®¡ç†ä¸æŠ€æœ¯å®è·µ

## å‰è¨€
----------------------------------------
ä»Šå¤©ä¸Šäº†ä¸€å¤©çš„è¯¾ï¼Œæœ‰ç‚¹ç´¯ï¼Œå…ˆè¯´è¯´å®‰æ’ï¼šå­¦å®Œå‘˜å·¥ç®¡ç†å’Œäº‹åŠ¡ç®¡ç†éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„çœ‹çœ‹æ—¶é—´å†è¯´å§ã€‚

## æ—¥ç¨‹
----------------------------------------
5ç‚¹åŠï¼Œä¸Šäº†ä¸€å¤©çš„è¯¾ï¼Œç°åœ¨æ¥å­¦ä¸€ä¼šï¼Œå­¦åˆ°å›°äº†å†å»ç¡ä¼šã€‚  
ç°åœ¨å°†è¿‘12ç‚¹ï¼Œåˆ†ç¥æ˜¯è¦ä»˜å‡ºä»£ä»·çš„ï¼Œä»£ä»·å°±æ˜¯å¤šèŠ±äº†åŠå°æ—¶ä¿®bugã€‚  
æŠŠblogå†™äº†å†ç¡ğŸ˜¡  
é¡ºä¾¿ä¸€æåªå­¦å®Œäº†å‘˜å·¥ç®¡ç†éƒ¨åˆ†ï¼Œä¸è¡¥è§‰çš„è¯åˆšå¥½ä¸ç”¨ç†¬å¤œã€‚

## å­¦ä¹ å†…å®¹
----------------------------------------
### çœæµ
1. åˆ†é¡µæŸ¥è¯¢
2. åŠ¨æ€SQL
3. çŠ¯çš„é€†å¤©é”™è¯¯

### 1. åˆ†é¡µæŸ¥è¯¢
#### ä¼ ç»Ÿæ–¹æ³•
æˆ‘ä»¬éœ€è¦ä»å‰ç«¯è¿”å›ä¸¤ä¸ªå‚æ•°ï¼šå½“å‰é¡µç `page`ï¼Œæ¯é¡µå±•ç¤ºè®°å½•æ•°`pageSize`ã€‚  
æˆ‘ä»¬éœ€è¦ä»æ•°æ®åº“è·å–ä¸¤ä¸ªå‚æ•°ï¼š`count`ï¼ˆæ€»è®°å½•æ•°ï¼‰å’Œç»“æœåˆ—è¡¨ã€‚

```sql
@Select("select count(*) from emp e left join dept d on e.dept_id = d.id")
@Select("select e.*,d.name deptName from emp e left join dept d on e.dept_id = d.id " +
        "order by e.update_time desc limit #{start},#{pageSize}") #start = (page-1)*pageSize
```

å°†è·å–çš„ç»“æœä½œä¸ºä¸€ä¸ªå°è£…ç±»è¿”å›ï¼š
```java
public class PageResult<T> {
    private Long total;
    private List<T> rows;
}
```

æœ€åä½œä¸º`Result`çš„`data`æ•°æ®è¿›è¡Œè¿”å›ï¼š
```java
return Result.success(pageResult);
```

#### PageHelperåˆ†é¡µæ’ä»¶
é€šè¿‡`PageHelper`åˆ†é¡µæ’ä»¶ï¼Œæˆ‘ä»¬èƒ½æ›´ç®€å•åœ°å®ç°è¿™ä¸ªè¿‡ç¨‹ã€‚

å¼•å…¥ä¾èµ–ï¼š
```xml
<!-- åˆ†é¡µæ’ä»¶ PageHelper -->
<dependency>
   <groupId>com.github.pagehelper</groupId>
   <artifactId>pagehelper-spring-boot-starter</artifactId>
   <version>1.4.7</version>
</dependency>
```

ä½¿ç”¨æ–¹æ³•ï¼š
```java
@Override
public PageResult<Emp> page(Integer page, Integer pageSize) {
    // 1. è®¾ç½®å‚æ•°
    PageHelper.startPage(page, pageSize);
    // 2. æ‰§è¡ŒæŸ¥è¯¢
    List<Emp> list = empMapper.list();
    // 3. è§£ææŸ¥è¯¢ç»“æœ
    Page<Emp> pageList = (Page<Emp>) list;
    return new PageResult<Emp>(pageList.getTotal(), pageList.getResult());
}
```

ä¼˜åŒ–ç‚¹ï¼šå½“æˆ‘ä»¬ä¼ é€’çš„å‚æ•°è¿‡å¤šæ—¶ï¼Œå¯ä»¥å°è£…æˆä¸€ä¸ªæ•´ä½“ç±»è¿›è¡Œå‚æ•°ä¼ é€’ï¼š
```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class EmpQueryParam {
    private Integer page;
    private Integer pageSize;
    private String name;
    private Integer gender;
    private @DateTimeFormat(pattern = "yyyy-mm-dd") LocalDate begin;
    private @DateTimeFormat(pattern = "yyyy-mm-dd") LocalDate end;
}
```
**æ³¨æ„**ï¼šæ¥æ”¶å‰ç«¯çš„æ—¥æœŸç±»å˜é‡æ—¶ï¼Œéœ€è¦ç”¨`@DateTimeFormat`æ³¨è§£å»æŒ‡å®šå®ƒçš„æ ¼å¼ã€‚

### 2. åŠ¨æ€SQL
#### `<where>`æ ‡ç­¾
`<where>`æ ‡ç­¾èƒ½å¤Ÿè‡ªåŠ¨æ ¹æ®æƒ…å†µå»é™¤`and`ã€‚

#### `<if>`æ ‡ç­¾
`<if>`æ ‡ç­¾å¯ä»¥æ§åˆ¶æ¡ä»¶æ»¡è¶³æ—¶æ‰å»æ‰§è¡Œå¯¹åº”çš„è¯­å¥ï¼š
```xml
<select id="list" resultType="com.itheima.pojo.Emp">
    select e.*,d.name from emp e left join dept d on e.dept_id = d.id
    <where>
        <if test="name != null and name != ''">
            e.name like concat('%',#{name},'%')
        </if>
        <if test="gender != null">
            and e.gender = #{gender}
        </if>
        <if test="begin != null and end != null">
            and e.entry_date between #{begin} and #{end}
        </if>
    </where>
    order by e.update_time desc
</select>
```

#### `<foreach>`æ ‡ç­¾
`<foreach>`æ ‡ç­¾ï¼šéå†æ‰§è¡Œè¯­å¥ã€‚å±æ€§è¯´æ˜ï¼š
- `collection`ï¼šé›†åˆåç§°
- `item`ï¼šé›†åˆéå†å‡ºæ¥çš„å…ƒç´ /é¡¹
- `separator`ï¼šæ¯ä¸€æ¬¡éå†ä½¿ç”¨çš„åˆ†éš”ç¬¦
- `open`ï¼šéå†å¼€å§‹å‰æ‹¼æ¥çš„ç‰‡æ®µ
- `close`ï¼šéå†ç»“æŸåæ‹¼æ¥çš„ç‰‡æ®µ

æ‰¹é‡æ·»åŠ æ•°æ®ï¼š
```xml
<insert id="insertBatch">
    insert into emp_expr(emp_id, begin, end, company, job) values
    <foreach collection="exprList" item="item" separator=",">
        (#{item.empId},#{item.begin},#{item.end},#{item.company},#{item.job})
    </foreach>
</insert>
```

### 3. çŠ¯çš„é€†å¤©é”™è¯¯
1. **`@Options`æ³¨è§£é”™è¯¯**  
   - æŠŠ`@Options`å†™åˆ°äº†`service`å±‚çš„æ¥å£ä¸‹ï¼ˆå› ä¸ºæ–¹æ³•åç›¸åŒï¼Œçœ¼èŠ±äº†ï¼‰ã€‚
   - å°†`@Options`å’Œ`xml`æ˜ å°„æ··ç”¨äº†ã€‚  
   æ­£ç¡®ç¤ºä¾‹ï¼š
     ```java
     @Options(useGeneratedKeys = true, keyProperty = "id")
     @Insert("insert into emp(username, password, name, gender, phone, job, salary, image, entry_date, dept_id, create_time, update_time) " +
             "values(#{username},#{password},#{name},#{gender},#{phone},#{job},#{salary},#{image},#{entryDate},#{deptId},#{createTime},#{updateTime}) ")
     void save(Emp emp);
     ```

2. **`<foreach>`æ ‡ç­¾é”™è¯¯**  
   - å°†`values`æ”¾åœ¨`<foreach>`å†…éƒ¨äº†ï¼Œå¾ˆæ˜¾ç„¶æ˜¯é”™è¯¯çš„ã€‚

3. **å‚æ•°æ¥æ”¶é”™è¯¯**  
   - åœ¨è·å–å‰ç«¯çš„å‚æ•°æ—¶ï¼Œ`Emp`å°è£…ç±»ä¸­ä¸€ä¸ªå˜é‡ä¸æ¥å£å‡½æ•°çš„è¦æ±‚ä¸ç¬¦ï¼ˆ`exprList -> empExprList`ï¼‰ã€‚  
   è¿™ä¼šå¯¼è‡´`@RequestBody Emp emp`ä½“è·å–ä¸åˆ°è¯·æ±‚ä½“ä¸­å¯¹åº”çš„å‚æ•°ã€‚

## ç»“è¯­
----------------------------------------
ç¡è§‰ã€‚
