# JMeter 学习笔记

## 前言
----------------------------------------
住在我心里孤独的，孤独的海怪，痛苦之王~  
开始厌倦，深海的光，停滞的海浪~  

----------------------------------------

## 日程
----------------------------------------
今天属实有点懒，一天磨磨蹭蹭只把 JMeter 简单学会了，其实有用的内容反而不多。  

----------------------------------------

## 学习内容
----------------------------------------
### 省流：
1. JMeter

### 1. JMeter
用于后端自动化脚本测试和压力测试的开源软件。  
[Apache JMeter - Download Apache JMeter](https://jmeter.apache.org/download_jmeter.cgi)

#### 1）配置文件
用于设置一些全局性的配置，如 HTTP 请求默认值。  
假如想要发送 JSON 格式的数据，则需要在 HTTP 信息头管理器中设置：
```
Content-Type | application/json;charset=utf-8
```

**CSV 数据文件设置**  
CSV 文件是一种以逗号分隔的纯文本文件，格式为 `.csv` 或 `.txt`。  
例如：
```
test1,https://example.com/poster3.jpg,2010-09-01,148,科幻,9.2,1
test2,https://example.com/poster3.jpg,2010-09-01,148,科幻,9.2,1
test3,https://example.com/poster3.jpg,2010-09-01,148,科幻,9.2,1
test4,https://example.com/poster3.jpg,2010-09-01,148,科幻,9.2,1
test5,https://example.com/poster3.jpg,2010-09-01,148,科幻,9.2,1
```
在导入 CSV 文件后，要设置一一对应的变量名称：
```
title,posterUrl,releaseDate,duration,genre,rating,status
```
有点像 SQL 表格。  
用户定义的变量：相当于全局变量，名称到值的映射。

#### 2）监控
- **查看结果树**：查看发送的请求的相关信息，如请求数据、响应结果等。  
- **聚合报告**：查看平均响应时间、吞吐量等性能指标数据。

#### 3）线程组
测试逻辑的执行单位。  
- **Ramp-up**：线程从 0 逐步增加到设定的最大线程数所需的时间。  
- **注意**：如果不在测试计划中设置独立运行每个线程组，则线程组随机竞争执行。

#### 4）插值表达式 `${}`
JMeter 中用于表示变量的函数式，几乎可以用在任何地方，如名称、请求路径。  
在函数助手中，有许多内置的函数，如计数器 `counter`、时间函数 `time`。

#### 5）逻辑控制器
比较简单，这里就说说 `if` 的固定判断格式：
```
"值1" == "值2"
```

#### 6）关联
通过后置处理器的提取器，可以将一个 HTTP 请求的响应数据作为变量给到下一个 HTTP 请求。  
**正则表达式提取器示例**：
| 变量名 | 正则表达式 | 模板 |
|--------|------------|------|
| val    | `"id":"(.*?)"` | `$1$` |

**跨线程组关联**：  
生成 `setProperty` 函数 `${__setProperty(out,${val},)}`。  
将 `setProperty` 函数添加进 BeanShell 取样器中：
```
${__setProperty(out,${val},)}
```
通过 `property` 函数取出该变量：
```
${__property(out,,)}
```

#### 7）高并发与高频率
**高并发**：  
设置同步定时器：
- **模拟用户数**：同步定时器会同步线程组中的该数量的线程，并同时发送请求（相当于把线程分成一个个的组进行发送）。  
- **超时时间**：强制发送一个组的等待时间（即使这个组的装配线程数量还没有到达模拟用户数）。  
**注意**：设置 `Ramp-Up = 0`，所有线程立即启动，但仍可能存在微小时间差（非严格同步）。

**高频率**：  
常数吞吐量定时器：设置总请求速率会被限制在 60 RPS（即所有线程的请求加起来，每秒最多 60 次），假如有多个线程则会均衡调配每个线程的请求频率。

#### 8）自动化脚本配置思路
将增、删、查、改分别放在一个线程组中，跨线程组关联变量，按顺序执行线程组，并提供断言判断结果是否符合预期。

#### 9）图形化测试报告
生成图形化测试报告。在 JMeter 中可以以图形化（饼状图、柱状图等）的方式显示脚本运行结果，较之于聚合报告或查看结果树组件实现更直观。  
**命令**：
```
jmeter -n -t 脚本文件 -l 日志文件 -e -o 目录
```
- `-n`：无图形化运行。  
- `-t`：被运行的脚本。  
- `-l`：将运行信息写入日志文件。  
- `-e`：生成测试报告。  
- `-o`：指定报告输出目录。  

**命令行示例**：
```
D:\apache-jmeter-5.1.1\bin\jmeter -n -t test.jmx -l hm.txt -e -o .\html
```

----------------------------------------

## 结语
----------------------------------------
今晚不能熬夜，感觉一熬夜整天都会垮掉，明天要抓紧时间做项目。  

----------------------------------------